<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubEnum v4.3 ‚Ä¢ Wildcard Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap');
        body { font-family: 'Space Grotesk', sans-serif; }
        .log-line { font-family: ui-monospace, monospace; }
        .pill { transition: all 0.2s cubic-bezier(0.4,0,0.2,1); }
        .pill:hover { transform: translateY(-2px) scale(1.03); }
        #trafficCanvas { background: #18181b; border-radius: 24px; }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-200">
<div class="min-h-screen flex">
    <!-- Sidebar -->
    <div class="w-96 bg-zinc-900 border-r border-zinc-800 p-6 flex flex-col overflow-y-auto">
        <div class="flex items-center gap-3 mb-8">
            <div class="w-10 h-10 bg-gradient-to-br from-violet-500 to-fuchsia-500 rounded-3xl flex items-center justify-center text-black font-black text-2xl">S</div>
            <div>
                <h1 class="text-3xl font-bold tracking-tighter">SubEnum <span class="text-xs text-violet-400 align-super">v4.3</span></h1>
                <p class="text-xs text-zinc-500 -mt-1">root + PSL + wildcard detection</p>
            </div>
        </div>

        <div class="space-y-7">
            <!-- Target -->
            <div>
                <label class="block text-sm font-medium text-zinc-400 mb-1.5">TARGET DOMAIN</label>
                <input id="target" type="text" value="pwndefend.com" 
                       class="w-full bg-zinc-800 border border-zinc-700 rounded-3xl px-5 py-4 text-lg focus:outline-none focus:border-violet-500">
            </div>

            <!-- DNS Providers -->
            <div>
                <label class="block text-sm font-medium text-zinc-400 mb-3">DNS PROVIDERS (round-robin)</label>
                <div id="providerCheckboxes" class="grid grid-cols-2 gap-2"></div>
                <div class="mt-4 flex gap-3">
                    <input id="customDoh" placeholder="https://your-doh.example.com/dns-query" 
                           class="flex-1 bg-zinc-800 border border-zinc-700 rounded-3xl px-5 py-3 text-sm font-mono">
                    <button onclick="addCustomProvider()" 
                            class="bg-zinc-800 hover:bg-zinc-700 px-6 rounded-3xl text-sm font-medium">ADD</button>
                </div>
                <div id="customProvidersList" class="mt-3 space-y-1 text-xs"></div>
            </div>

            <!-- WORDLIST -->
            <div>
                <div class="flex justify-between items-center mb-1.5">
                    <label class="block text-sm font-medium text-zinc-400">WORDLIST</label>
                    <button onclick="uploadWordlist()" 
                            class="text-xs px-3 py-1 bg-zinc-800 hover:bg-zinc-700 rounded-xl flex items-center gap-1">
                        <i class="fa-solid fa-upload"></i> Upload
                    </button>
                </div>
                <textarea id="wordlist" rows="6" 
                          class="w-full bg-zinc-800 border border-zinc-700 rounded-3xl p-4 text-sm font-mono resize-none focus:outline-none focus:border-violet-500">www
api
admin
dev
test
staging
prod
beta
demo
shop
blog
app
mobile
login
portal
dashboard
cdn
static
assets
media
internal
secure
auth
vpn
git
jenkins</textarea>
            </div>

            <!-- Record Types -->
            <div>
                <label class="block text-sm font-medium text-zinc-400 mb-3">RECORD TYPES</label>
                <div id="recordTypeCheckboxes" class="grid grid-cols-4 gap-2"></div>
            </div>

            <!-- PSL & Root -->
            <div>
                <label class="block text-sm font-medium text-zinc-400 mb-2">ROOT DOMAIN & PSL</label>
                <div class="flex items-center gap-3 bg-zinc-800 rounded-3xl p-4">
                    <input type="checkbox" id="usePSL" checked class="accent-violet-500 w-5 h-5">
                    <div>
                        <div class="text-sm">Smart base detection</div>
                        <div class="text-xs text-zinc-500">Handles gov.uk, co.uk, etc.</div>
                    </div>
                </div>
                <button onclick="loadFullPSL()" class="mt-3 w-full bg-zinc-800 hover:bg-zinc-700 py-3 rounded-3xl text-sm font-medium flex items-center justify-center gap-2">
                    <i class="fa-solid fa-globe"></i> Load Full PSL (Mozilla)
                </button>
                <div id="pslStatus" class="text-[10px] text-emerald-400 mt-1 text-center">Built-in PSL active</div>
            </div>

            <!-- WILDCARD STATUS -->
            <div id="wildcardStatus" class="hidden bg-amber-500/10 border border-amber-500/50 rounded-3xl p-4">
                <div class="flex items-center gap-3 text-amber-400">
                    <i class="fa-solid fa-triangle-exclamation text-xl"></i>
                    <div>
                        <div class="font-semibold text-sm">WILDCARD DNS DETECTED</div>
                        <div id="wildcardDetail" class="text-xs">Random subdomains are resolving</div>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs text-zinc-400 mb-1">CONCURRENCY</label>
                    <input id="concurrency" type="range" min="5" max="100" value="25" class="w-full accent-violet-500">
                    <div id="concurrencyValue" class="text-center text-sm font-mono text-violet-400">25</div>
                </div>
                <div>
                    <label class="block text-xs text-zinc-400 mb-1">MAX DEPTH</label>
                    <select id="maxDepth" class="w-full bg-zinc-800 border border-zinc-700 rounded-3xl px-5 py-4 text-sm">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </div>
            </div>

            <!-- Progress -->
            <div id="progressSection" class="hidden">
                <div class="flex justify-between text-xs text-zinc-400 mb-1">
                    <span>PROGRESS</span>
                    <span id="progressPercent" class="font-mono text-violet-400">0%</span>
                </div>
                <div class="h-2.5 bg-zinc-800 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-gradient-to-r from-violet-500 via-fuchsia-500 to-cyan-400 w-0 transition-all"></div>
                </div>
                <div class="mt-1 flex justify-between text-[10px] font-mono text-zinc-500">
                    <span>Depth <span id="currentDepth">1</span>/<span id="maxD">2</span></span>
                    <span><span id="checksDone">0</span>/<span id="checksTotal">0</span></span>
                </div>
            </div>

            <button onclick="startScan()" id="startBtn" 
                    class="w-full bg-violet-600 hover:bg-violet-500 py-4 rounded-3xl font-semibold flex items-center justify-center gap-2">
                <i class="fa-solid fa-bolt"></i> START SCAN
            </button>

            <button onclick="stopScan()" id="stopBtn" 
                    class="w-full py-3 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-3xl hidden font-medium">STOP SCAN</button>
        </div>

        <div class="mt-auto pt-8 text-[10px] text-zinc-500">v4.3 ‚Ä¢ Root + PSL + Wildcard Detection</div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col">
        <div class="border-b border-zinc-800 px-8 py-5 flex items-center justify-between bg-zinc-900">
            <div class="flex gap-6">
                <button onclick="showTab(0)" id="tab0" class="tab-btn active px-6 py-2 rounded-3xl text-sm font-medium">RESULTS</button>
                <button onclick="showTab(1)" id="tab1" class="tab-btn px-6 py-2 rounded-3xl text-sm font-medium">LOG</button>
                <button onclick="showTab(2)" id="tab2" class="tab-btn px-6 py-2 rounded-3xl text-sm font-medium">DASHBOARD</button>
            </div>
            <div class="flex gap-3">
                <button onclick="clearResults()" class="px-5 py-2 text-xs border border-zinc-700 rounded-3xl hover:bg-zinc-800">CLEAR</button>
                <button onclick="exportCSV()" class="px-5 py-2 text-xs bg-zinc-800 hover:bg-zinc-700 rounded-3xl">EXPORT CSV</button>
            </div>
        </div>

        <!-- RESULTS -->
        <div id="tabContent0" class="flex-1 overflow-auto p-8">
            <table class="w-full">
                <thead class="bg-zinc-900 sticky top-0 z-10">
                    <tr class="text-xs text-zinc-400 border-b border-zinc-800">
                        <th class="py-5 px-6 text-left">#</th>
                        <th class="py-5 px-6 text-left">SUBDOMAIN</th>
                        <th class="py-5 px-6 text-left">IPs</th>
                        <th class="py-5 px-6 text-left">CNAME</th>
                        <th class="py-5 px-6 text-left">OTHER</th>
                        <th class="py-5 px-6 text-left">DEPTH</th>
                        <th class="py-5 px-6 w-20"></th>
                    </tr>
                </thead>
                <tbody id="resultsBody" class="text-sm divide-y divide-zinc-800"></tbody>
            </table>
        </div>

        <!-- LOG -->
        <div id="tabContent1" class="flex-1 overflow-auto p-8 hidden bg-black">
            <div id="log" class="font-mono text-xs text-zinc-300 space-y-1 h-full overflow-auto"></div>
        </div>

        <!-- DASHBOARD -->
        <div id="tabContent2" class="flex-1 overflow-auto p-8 hidden bg-zinc-950">
            <div class="max-w-7xl mx-auto space-y-8">
                <div class="grid grid-cols-4 gap-6">
                    <div class="bg-zinc-900 rounded-3xl p-6">
                        <div class="text-xs text-zinc-500">TOTAL QUERIES</div>
                        <div id="statQueries" class="text-5xl font-bold text-white mt-2 font-mono">0</div>
                    </div>
                    <div class="bg-zinc-900 rounded-3xl p-6">
                        <div class="text-xs text-zinc-500">SUCCESSFUL</div>
                        <div id="statSuccess" class="text-5xl font-bold text-emerald-400 mt-2 font-mono">0</div>
                    </div>
                    <div class="bg-zinc-900 rounded-3xl p-6">
                        <div class="text-xs text-zinc-500">RATE</div>
                        <div id="statRate" class="text-5xl font-bold text-amber-400 mt-2 font-mono">0/s</div>
                    </div>
                    <div class="bg-zinc-900 rounded-3xl p-6">
                        <div class="text-xs text-zinc-500">SUCCESS %</div>
                        <div id="statSuccessPct" class="text-5xl font-bold text-sky-400 mt-2 font-mono">0%</div>
                    </div>
                </div>

                <div>
                    <div class="text-sm font-medium text-zinc-400 mb-4">DNS PROVIDERS LIVE</div>
                    <div id="providersGrid" class="grid grid-cols-3 gap-4"></div>
                </div>

                <div>
                    <div class="text-sm font-medium text-zinc-400 mb-4 flex items-center gap-3">
                        TRAFFIC FLOW ‚Ä¢ CLIENT ‚Üí PROVIDERS
                        <div class="flex-1 h-px bg-zinc-800"></div>
                    </div>
                    <canvas id="trafficCanvas" width="1100" height="220" class="w-full"></canvas>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div class="bg-zinc-900 rounded-3xl p-6">
                        <div class="text-sm font-medium text-zinc-400 mb-4">RESOLUTIONS OVER TIME</div>
                        <canvas id="lineChart" height="140"></canvas>
                    </div>
                    <div class="bg-zinc-900 rounded-3xl p-6">
                        <div class="text-sm font-medium text-zinc-400 mb-4">REQUESTS PER PROVIDER</div>
                        <canvas id="barChart" height="140"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="border-t border-zinc-800 bg-zinc-900 px-8 py-4 text-xs text-zinc-500 flex justify-between">
            <div>v4.3 ‚Ä¢ Wildcard detection active</div>
            <div id="status" class="font-mono">Ready</div>
        </div>
    </div>
</div>

<input type="file" id="wordlistUpload" accept=".txt" class="hidden" onchange="handleFileUpload(event)">

<script>
    // ================== PUBLIC SUFFIX LIST (unchanged) ==================
    let psl = new Set([...]); // same as previous
    async function loadFullPSL() { /* unchanged */ }

    function getRegistrableDomain(domain) { /* unchanged */ }

    // ================== WILDCARD DETECTION ==================
    let isWildcard = false;

    async function performWildcardCheck(baseDomain) {
        log('üîç Performing wildcard DNS detection...', 'info');
        const randomSubs = [];
        for (let i = 0; i < 3; i++) {
            const rand = crypto.randomUUID ? crypto.randomUUID().replace(/-/g, '').slice(0, 12) : Math.random().toString(36).substring(2, 14);
            randomSubs.push(`${rand}.${baseDomain}`);
        }

        let wildcardDetected = false;
        for (const testSub of randomSubs) {
            const res = await resolveSubdomain(testSub);
            if (res.ips.length || res.cname || res.other) {
                wildcardDetected = true;
                break;
            }
        }

        isWildcard = wildcardDetected;

        const banner = document.getElementById('wildcardStatus');
        if (wildcardDetected) {
            banner.classList.remove('hidden');
            document.getElementById('wildcardDetail').textContent = `Random subs resolve ‚Üí *.${baseDomain} is wildcard`;
            log(`‚ö†Ô∏è WILDCARD DETECTED on ${baseDomain} ‚Äî random subdomains resolve`, 'error');
        } else {
            banner.classList.add('hidden');
            log('‚úÖ No wildcard detected ‚Äî normal enumeration', 'success');
        }
        return wildcardDetected;
    }

    // ================== REST OF THE CODE (same as v4.2 with wildcard integration) ==================
    let defaultProviders = [ /* unchanged */ ];
    let customProviders = [];
    let providerIndex = 0;

    const recordTypeList = [ /* unchanged */ ];

    let providerStats = {};
    let totalQueries = 0, totalSuccess = 0, lastSecondQueries = 0, rate = 0;
    let resolutionHistory = [];
    let lineChart, barChart;

    let isRunning = false, stopRequested = false;
    let results = [], discovered = new Set();
    let totalChecks = 0, completedChecks = 0, currentDepth = 0;

    const logEl = document.getElementById('log');
    const resultsBody = document.getElementById('resultsBody');
    let trafficCtx, trafficParticles = [];
    let animationFrame;

    function log(msg, type='info') {
        const t = new Date().toLocaleTimeString('en-US',{hour12:false});
        const cls = type==='success'?'text-emerald-400':type==='error'?'text-red-400':'text-zinc-400';
        logEl.innerHTML += `<div class="log-line ${cls}">[${t}] ${msg}</div>`;
        logEl.scrollTop = logEl.scrollHeight;
    }

    function getSelectedProviders() { /* unchanged */ }
    function getNextDoHUrl() { /* unchanged */ }

    async function resolveSubdomain(sub) { /* unchanged - same as v4.2 */ }

    function updateLiveStats() { /* unchanged */ }
    function renderProvidersGrid() { /* unchanged */ }
    function initTrafficCanvas() { /* unchanged */ }
    function drawTraffic() { /* unchanged */ }
    function startTrafficAnimation() { /* unchanged */ }
    function initCharts() { /* unchanged */ }
    function updateCharts() { /* unchanged */ }
    function updateDashboard() { /* unchanged */ }

    function createLimiter(max) { /* unchanged */ }

    function addResult(sub, res, depth) { /* unchanged */ }
    function renderResults() { /* unchanged */ }

    async function bruteForce(bases, depth, maxDepth, limiter) { /* unchanged */ }

    function updateProgress() { /* unchanged */ }

    async function startScan() {
        if (isRunning) return;
        let target = document.getElementById('target').value.trim().toLowerCase();
        if (!target.includes('.')) return alert('Enter a valid domain');

        resetScan();
        const useSmartPSL = document.getElementById('usePSL').checked;
        const baseDomain = useSmartPSL ? getRegistrableDomain(target) : target;

        log(`Target: ${target}`, 'info');
        log(`Registrable base: ${baseDomain}`, 'success');

        // === WILDCARD CHECK ===
        await performWildcardCheck(baseDomain);

        const concurrency = parseInt(document.getElementById('concurrency').value);
        const maxD = parseInt(document.getElementById('maxDepth').value);
        const limiter = createLimiter(concurrency);

        document.getElementById('progressSection').classList.remove('hidden');

        // === ROOT DOMAIN ===
        log('Enumerating root domain...', 'info');
        const rootRes = await resolveSubdomain(target);
        addResult(target, rootRes, 0);

        // === SUBDOMAIN BRUTE FORCE ===
        log(`Starting recursive brute-force on ${baseDomain}`, 'info');
        await bruteForce([baseDomain], 1, maxD, limiter);

        finishScan();
    }

    function resetScan() {
        isRunning = true; stopRequested = false;
        results = []; discovered = new Set();
        providerStats = {}; totalQueries = 0; totalSuccess = 0;
        resolutionHistory = [];
        totalChecks = completedChecks = 0;
        isWildcard = false;
        document.getElementById('wildcardStatus').classList.add('hidden');
        resultsBody.innerHTML = ''; logEl.innerHTML = '';
        trafficParticles = [];
        document.getElementById('startBtn').classList.add('opacity-50','cursor-not-allowed');
        document.getElementById('stopBtn').classList.remove('hidden');
    }

    function finishScan() {
        isRunning = false;
        document.getElementById('startBtn').classList.remove('opacity-50','cursor-not-allowed');
        document.getElementById('stopBtn').classList.add('hidden');
        document.getElementById('progressSection').classList.add('hidden');
        log('‚úÖ Scan completed!', 'success');
    }

    function stopScan() { stopRequested = true; log('‚èπ Stop requested', 'error'); }

    function clearResults() { /* unchanged */ }
    function exportCSV() { /* unchanged */ }

    function initUI() { /* unchanged */ }
    function showTab(n) { /* unchanged */ }
    function addCustomProvider() { /* unchanged */ }
    function renderCustomProviders() { /* unchanged */ }
    function removeCustom(i) { /* unchanged */ }
    function uploadWordlist() { /* unchanged */ }
    function handleFileUpload(e) { /* unchanged */ }

    window.onload = () => {
        initUI();
        initTrafficCanvas();
        initCharts();
        showTab(0);
        log('SubEnum v4.3 ready ‚Ä¢ Wildcard detection + root + PSL', 'success');
        log('Random GUID-style subdomains are now tested on every scan', 'info');

        setInterval(() => {
            if (isRunning || !document.getElementById('tabContent2').classList.contains('hidden')) updateDashboard();
        }, 800);
    };
</script>
</body>
</html>
